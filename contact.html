<!DOCTYPE html>
<html lang="en">
<head>
  <!-- META -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Privé Cartel • Contact</title>
  <meta name="description" content="Get in touch with our leadership team.">
  <link rel="icon" type="image/png" href="/images/Emblem.png">

  <!-- FONTS & ICONS -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;700&family=Cormorant+Garamond:wght@500;600&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

  <!-- GLOBAL THEME -->
  <link rel="stylesheet" href="/assets/style.css">

  <!-- PAGE-ONLY CSS -->
  <style>
    :root{
      --card-bg: hsla(0 0% 100% / 0.04);
      --card-gold: var(--accent);
      --card-gold-faint: rgba(var(--accent-rgb),.55);
      --card-radius: var(--radius);
      --lift: 0 8px 22px rgba(0,0,0,.55);
      --t: .4s cubic-bezier(.22,.61,.36,1);
    }

    html,body{height:100%}
    body{display:flex;flex-direction:column;margin:0}
    main{flex:1}
    .contact-section{padding-top:6rem}

    /* grid — centered tracks + tidy card width, upgrades to 4 cols on very wide screens */
    .contact-grid{
      display:grid;
      gap:1.6rem;
      grid-template-columns:repeat(auto-fit,minmax(280px,320px));
      justify-content:center;                 /* centers the final row */
      margin:2.8rem 0;
      opacity:0;transform:translateY(16px);
      animation:fadeSlide .6s ease forwards .25s;
    }
    @media (min-width:1440px){
      .contact-grid{ grid-template-columns:repeat(4,minmax(280px,320px)); }
    }
    @keyframes fadeSlide{to{opacity:1;transform:none}}

    /* card */
    .profile-card{
      position:relative;
      display:flex;flex-direction:column;align-items:center;
      padding:1.9rem 1.5rem;
      background:var(--card-bg);
      backdrop-filter:blur(12px);
      border:1px solid var(--card-gold-faint);
      border-radius:var(--card-radius);
      text-decoration:none!important;
      transition:transform var(--t),box-shadow var(--t),border-color var(--t);
      height:100%;
    }
    .profile-card:hover,
    .profile-card:focus-visible{border-color:var(--card-gold)}
    .profile-card:hover{
      transform:translateY(-6px) rotateX(4deg) rotateY(-2deg);
      box-shadow:var(--lift);
    }
    .profile-card:focus-visible{outline:2px solid var(--accent);outline-offset:4px}

    .profile-card .avatar{
      width:95px;height:95px;margin-bottom:1.1rem;
      border-radius:50%;object-fit:cover;border:2px solid var(--accent);
    }
    .profile-card h3{margin:.1rem 0 .35rem;color:var(--accent);font-size:1.25rem;text-align:center}
    .profile-card .role{margin:0 0 1rem;color:var(--text-2);font-size:.95rem;text-align:center}
    .profile-card h3::after{content:"";display:block;margin:.6rem auto 1rem;width:44px;height:1px;background:var(--accent)}
    .profile-card .bio{margin:0;font-size:.9rem;line-height:1.45;color:var(--text-2);text-align:center}

    .contact-note{text-align:center;color:var(--text-2);font-size:.9rem;margin-top:1.2rem}
    footer{background:#000;border-top:2px solid var(--accent);text-align:center;padding:1.25rem 1rem;color:var(--text-2)}

    /* underline hover only in contact body */
    .contact-section a:not(.profile-card){
      text-decoration:none;
      background-image:linear-gradient(var(--accent),var(--accent));
      background-size:0 1px;background-position:0 95%;background-repeat:no-repeat;
      transition:background-size .25s ease;
    }
    .contact-section a:not(.profile-card):hover,
    .contact-section a:not(.profile-card):focus-visible{background-size:100% 1px}

    /* status pill */
    .status-pill{
      position:absolute;top:.55rem;left:.6rem;
      font-size:.72rem;line-height:1;
      padding:.25rem .45rem .28rem;
      border-radius:.45rem;
      background:rgba(0,0,0,.55);
      backdrop-filter:blur(4px);
      border:1px solid rgba(255,255,255,.15);
      font-weight:600;letter-spacing:.01em;
      color:#aaa;
      display:flex;align-items:center;gap:.35rem;
      pointer-events:none;
      min-width:60px;justify-content:center;
      transition: color .25s ease, background .25s ease, border-color .25s ease;
    }
    .status-pill::before{
      content:"";
      width:.45rem;height:.45rem;border-radius:50%;
      background:#888;
      transition: background-color .25s ease;
    }
    .status-pill.online{color:#49e96c;}
    .status-pill.online::before{background:#49e96c;}
    .status-pill.offline{color:#ff5e5e;}
    .status-pill.offline::before{background:#ff5e5e;}
    .status-pill.idle{color:#ffd95a;}
    .status-pill.idle::before{background:#ffd95a;}
    .status-pill.traveling{color:#29cfff;}
    .status-pill.traveling::before{background:#29cfff;}
    .status-pill.error{color:#ff8d8d;}
    .status-pill.error::before{background:#ff8d8d;}

    /* pop animation when state changes */
    @keyframes pill-pop {
      0%   { transform: scale(.9); opacity:.4; }
      50%  { transform: scale(1.12); opacity:1; }
      100% { transform: scale(1); opacity:1; }
    }
    .status-pill.changed{ animation: pill-pop .38s cubic-bezier(.22,.61,.36,1); }

    @media(prefers-reduced-motion:reduce){
      *,*:before,*:after{animation:none!important;transition:none!important}
      .profile-card:hover{transform:none}
    }
  </style>
</head>
<body>

<!-- NAVBAR -->
<script type="module" src="/assets/navbar.js"></script>
<pc-navbar></pc-navbar>
<div class="nav-overlay"></div>

<!-- HERO -->
<section class="rules-hero">
  <img src="/images/Emblem.png" alt="Cartel Emblem">
  <h1>Contact Our Leadership</h1>
  <p class="tagline" style="max-width:680px">
    Reach out to the Privé Cartel leadership team—tap a card to open a Torn profile.
  </p>
</section>

<!-- CONTACT GRID -->
<main>
  <section class="contact-section">
    <div class="container">
      <div class="contact-grid">

        <!-- ForeverHydrox -->
        <a class="profile-card" href="https://www.torn.com/profiles.php?XID=2753560"
           target="_blank" rel="noopener"
           aria-label="Open ForeverHydrox's Torn profile in a new tab">
          <span class="status-pill" data-id="2753560">…</span>
          <img class="avatar" src="/images/blankprofile.jpg" data-id="2753560" alt="">
          <h3>ForeverHydrox</h3>
          <p class="role">Leader</p>
          <p class="bio">
            Seasoned faction leader with more than three years of hands-on experience 
            orchestrating wars, coordinating chain-calls and shaping long-term strategy. 
            Oversees day-to-day operations, negotiates high-stakes diplomacy and ensures 
            every member has a clear path to growth and glory.
          </p>
        </a>

        <!-- Skillerious -->
        <a class="profile-card" href="https://www.torn.com/profiles.php?XID=3212954"
           target="_blank" rel="noopener"
           aria-label="Open Skillerious's Torn profile in a new tab">
          <span class="status-pill" data-id="3212954">…</span>
          <img class="avatar" src="/images/blankprofile.jpg" data-id="3212954" alt="">
          <h3>Skillerious</h3>
          <p class="role">Co-Leader</p>
          <p class="bio">
            Open-source userscript developer, data analyst and combat tactician. 
            Builds custom tools that automate faction workflows, crunches the numbers behind every OC, heist and territory push to give us 
            an edge nobody else can match.
          </p>
        </a>

        <!-- JdedPrincess -->
        <a class="profile-card" href="https://www.torn.com/profiles.php?XID=3400392"
           target="_blank" rel="noopener"
           aria-label="Open JdedPrincess's Torn profile in a new tab">
          <span class="status-pill" data-id="3400392">…</span>
          <img class="avatar" src="/images/blankprofile.jpg" data-id="3400392" alt="">
          <h3>JdedPrincess</h3>
          <p class="role">Co-Leader</p>
          <p class="bio">
            Creative tactician and morale champion, JdedPrincess keeps Privé Cartel cohesive, inspired, and tactically one step ahead.
          </p>
        </a>

        <!-- Igniatus -->
        <a class="profile-card" href="https://www.torn.com/profiles.php?XID=2541592"
           target="_blank" rel="noopener"
           aria-label="Open Igniatus's Torn profile in a new tab">
          <span class="status-pill" data-id="2541592">…</span>
          <img class="avatar" src="/images/blankprofile.jpg" data-id="2541592" alt="">
          <h3>Igniatus</h3>
          <p class="role">Treasurer</p>
          <p class="bio">
            Vault guardian and fiscal strategist. Reconciles OC payouts and member balances, 
            audits logs, and keeps our war chest liquid, accurate, and ready for whatever the 
            Cartel takes on next.
          </p>
        </a>

      </div><!-- /.contact-grid -->

      <p class="contact-note">
        Looking to join? Message any leader in-game or find us on Discord.
      </p>
    </div>
  </section>
</main>

<!-- FOOTER -->
<footer>
  <p>&copy; <span id="year"></span> Privé Cartel.</p>
</footer>

<!-- GLOBAL SCRIPT -->
<script src="/assets/script.js"></script>

<!-- LIVE STATUS & AVATARS -->
<script>
(async () => {
  const YEAR_EL = document.getElementById('year');
  YEAR_EL.textContent = new Date().getFullYear();

  const LS_KEY          = 'pcApiCipher';
  const REFRESH_MS      = 60_000;
  const MAX_BACKOFF_MS  = 10 * 60_000;
  let   delay           = REFRESH_MS;
  let   timer           = null;

  const cards = [...document.querySelectorAll('.profile-card')].map(card=>{
    const pill = card.querySelector('.status-pill');
    const img  = card.querySelector('.avatar');
    return { id: pill?.dataset.id, pill, img };
  });

  function classifyStatus(s){
    const v = (s||'').toLowerCase();
    if(v === 'online') return {cls:'online', txt:'Online'};
    if(v === 'idle' || v === 'recovering') return {cls:'idle', txt:'Idle'};
    if(/travel/.test(v)) return {cls:'traveling', txt:'Traveling'};
    return {cls:'offline', txt:'Offline'};
  }
  function humanAgo(ts){
    if(!ts) return '';
    const diff = Math.max(0, Date.now()/1000 - ts);
    const mins = Math.floor(diff/60);
    if(diff < 60) return 'Just now';
    if(mins < 60) return `${mins} minute${mins!==1?'s':''} ago`;
    const hrs = Math.floor(mins/60);
    if(hrs < 24) return `${hrs} hour${hrs!==1?'s':''} ago`;
    const days = Math.floor(hrs/24);
    return `${days} day${days!==1?'s':''} ago`;
  }
  function setStatus(pill, status, lastAction){
    if(!pill) return;
    const prev = pill.dataset.state || '';
    const {cls, txt} = classifyStatus(status);

    pill.textContent = txt;
    pill.classList.remove('online','offline','idle','traveling','error','changed');
    pill.classList.add(cls);

    if(lastAction){
      const ts = lastAction.timestamp || lastAction.last_action || 0;
      pill.title = lastAction.relative || humanAgo(ts) || '';
    }else pill.title = '';

    if(prev !== (status||'').toLowerCase()){
      void pill.offsetWidth;
      pill.classList.add('changed');
    }
    pill.dataset.state = (status||'').toLowerCase();
  }
  function setError(pill,msg='Error'){
    if(!pill) return;
    pill.textContent = msg;
    pill.title = msg;
    pill.classList.remove('online','offline','idle','traveling','changed');
    pill.classList.add('error');
  }

  async function decryptKey(hex){
    if(!hex || !crypto?.subtle) return '';
    try{
      const bytes = Uint8Array.from(hex.match(/../g).map(h=>parseInt(h,16)));
      const iv    = bytes.slice(0,12);
      const data  = bytes.slice(12);

      const originHash = await crypto.subtle.digest('SHA-256',
        new TextEncoder().encode(location.origin));
      const aesKey = await crypto.subtle.importKey('raw', originHash,
        {name:'AES-GCM'}, false, ['decrypt']);

      const plain = await crypto.subtle.decrypt({name:'AES-GCM',iv}, aesKey, data);
      return new TextDecoder().decode(plain);
    }catch(e){
      console.warn('Decrypt failed', e);
      return '';
    }
  }

  async function fetchUser(id, sels, key){
    const url = `https://api.torn.com/user/${id}?selections=${sels}&key=${key}`;
    const res = await fetch(url);
    return res.json();
  }

  async function hydrateOnce(key){
    await Promise.all(cards.map(async ({id,pill,img})=>{
      if(!id) return;
      try{
        const d = await fetchUser(id, 'basic,profile', key);
        if(d?.error){ setError(pill, d.error.error); return; }
        if(d.profile_image && img) img.src = d.profile_image;
        setStatus(pill, d.last_action?.status, d.last_action);
      }catch(err){
        console.error(err);
        setError(pill);
      }
    }));
    delay = REFRESH_MS;
  }

  async function refreshStatuses(key){
    try{
      let someoneOnline = false;
      await Promise.all(cards.map(async ({id,pill})=>{
        if(!id) return;
        try{
          const d = await fetchUser(id, 'basic', key);
          if(d?.error){ setError(pill, d.error.error); return; }
          const status = d.last_action?.status;
          if((status||'').toLowerCase()==='online') someoneOnline = true;
          setStatus(pill, status, d.last_action);
        }catch(err){
          console.error(err);
          setError(pill);
        }
      }));
      delay = someoneOnline ? REFRESH_MS : Math.max(REFRESH_MS*5, delay);
    }catch(err){
      delay = Math.min(delay*2, MAX_BACKOFF_MS);
      console.error(err);
    }finally{
      schedule(key);
    }
  }

  function schedule(key){
    clearTimeout(timer);
    if(document.hidden) return;
    timer = setTimeout(()=>refreshStatuses(key), delay + Math.floor(Math.random()*1500));
  }

  document.addEventListener('visibilitychange', ()=>{
    if(document.hidden){
      clearTimeout(timer);
    }else if(apiKey){
      refreshStatuses(apiKey);
    }
  });

  const cipher = localStorage.getItem(LS_KEY);
  const apiKey = await decryptKey(cipher);
  if(!apiKey) return; // no key, leave placeholders

  await hydrateOnce(apiKey);
  schedule(apiKey);
})();
</script>
</body>
</html>
